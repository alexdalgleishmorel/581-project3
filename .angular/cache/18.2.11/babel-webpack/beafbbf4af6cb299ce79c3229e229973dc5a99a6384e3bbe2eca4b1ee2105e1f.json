{"ast":null,"code":"import * as tf from '@tensorflow/tfjs-core';\nfunction getCenterCoordinatesAndSizesLayer(x) {\n  var vec = tf.unstack(tf.transpose(x, [1, 0]));\n  var sizes = [tf.sub(vec[2], vec[0]), tf.sub(vec[3], vec[1])];\n  var centers = [tf.add(vec[0], tf.div(sizes[0], tf.scalar(2))), tf.add(vec[1], tf.div(sizes[1], tf.scalar(2)))];\n  return {\n    sizes: sizes,\n    centers: centers\n  };\n}\nfunction decodeBoxesLayer(x0, x1) {\n  var _a = getCenterCoordinatesAndSizesLayer(x0),\n    sizes = _a.sizes,\n    centers = _a.centers;\n  var vec = tf.unstack(tf.transpose(x1, [1, 0]));\n  var div0_out = tf.div(tf.mul(tf.exp(tf.div(vec[2], tf.scalar(5))), sizes[0]), tf.scalar(2));\n  var add0_out = tf.add(tf.mul(tf.div(vec[0], tf.scalar(10)), sizes[0]), centers[0]);\n  var div1_out = tf.div(tf.mul(tf.exp(tf.div(vec[3], tf.scalar(5))), sizes[1]), tf.scalar(2));\n  var add1_out = tf.add(tf.mul(tf.div(vec[1], tf.scalar(10)), sizes[1]), centers[1]);\n  return tf.transpose(tf.stack([tf.sub(add0_out, div0_out), tf.sub(add1_out, div1_out), tf.add(add0_out, div0_out), tf.add(add1_out, div1_out)]), [1, 0]);\n}\nexport function outputLayer(boxPredictions, classPredictions, params) {\n  return tf.tidy(function () {\n    var batchSize = boxPredictions.shape[0];\n    var boxes = decodeBoxesLayer(tf.reshape(tf.tile(params.extra_dim, [batchSize, 1, 1]), [-1, 4]), tf.reshape(boxPredictions, [-1, 4]));\n    boxes = tf.reshape(boxes, [batchSize, boxes.shape[0] / batchSize, 4]);\n    var scoresAndClasses = tf.sigmoid(tf.slice(classPredictions, [0, 0, 1], [-1, -1, -1]));\n    var scores = tf.slice(scoresAndClasses, [0, 0, 0], [-1, -1, 1]);\n    scores = tf.reshape(scores, [batchSize, scores.shape[1]]);\n    var boxesByBatch = tf.unstack(boxes);\n    var scoresByBatch = tf.unstack(scores);\n    return {\n      boxes: boxesByBatch,\n      scores: scoresByBatch\n    };\n  });\n}","map":{"version":3,"names":["tf","getCenterCoordinatesAndSizesLayer","x","vec","unstack","transpose","sizes","sub","centers","add","div","scalar","decodeBoxesLayer","x0","x1","_a","div0_out","mul","exp","add0_out","div1_out","add1_out","stack","outputLayer","boxPredictions","classPredictions","params","tidy","batchSize","shape","boxes","reshape","tile","extra_dim","scoresAndClasses","sigmoid","slice","scores","boxesByBatch","scoresByBatch"],"sources":["/Users/alexdalgleishmorel/Desktop/UofC/FALL 24/581/581-project3/node_modules/face-api.js/build/es6/ssdMobilenetv1/outputLayer.js"],"sourcesContent":["import * as tf from '@tensorflow/tfjs-core';\r\nfunction getCenterCoordinatesAndSizesLayer(x) {\r\n    var vec = tf.unstack(tf.transpose(x, [1, 0]));\r\n    var sizes = [\r\n        tf.sub(vec[2], vec[0]),\r\n        tf.sub(vec[3], vec[1])\r\n    ];\r\n    var centers = [\r\n        tf.add(vec[0], tf.div(sizes[0], tf.scalar(2))),\r\n        tf.add(vec[1], tf.div(sizes[1], tf.scalar(2)))\r\n    ];\r\n    return {\r\n        sizes: sizes,\r\n        centers: centers\r\n    };\r\n}\r\nfunction decodeBoxesLayer(x0, x1) {\r\n    var _a = getCenterCoordinatesAndSizesLayer(x0), sizes = _a.sizes, centers = _a.centers;\r\n    var vec = tf.unstack(tf.transpose(x1, [1, 0]));\r\n    var div0_out = tf.div(tf.mul(tf.exp(tf.div(vec[2], tf.scalar(5))), sizes[0]), tf.scalar(2));\r\n    var add0_out = tf.add(tf.mul(tf.div(vec[0], tf.scalar(10)), sizes[0]), centers[0]);\r\n    var div1_out = tf.div(tf.mul(tf.exp(tf.div(vec[3], tf.scalar(5))), sizes[1]), tf.scalar(2));\r\n    var add1_out = tf.add(tf.mul(tf.div(vec[1], tf.scalar(10)), sizes[1]), centers[1]);\r\n    return tf.transpose(tf.stack([\r\n        tf.sub(add0_out, div0_out),\r\n        tf.sub(add1_out, div1_out),\r\n        tf.add(add0_out, div0_out),\r\n        tf.add(add1_out, div1_out)\r\n    ]), [1, 0]);\r\n}\r\nexport function outputLayer(boxPredictions, classPredictions, params) {\r\n    return tf.tidy(function () {\r\n        var batchSize = boxPredictions.shape[0];\r\n        var boxes = decodeBoxesLayer(tf.reshape(tf.tile(params.extra_dim, [batchSize, 1, 1]), [-1, 4]), tf.reshape(boxPredictions, [-1, 4]));\r\n        boxes = tf.reshape(boxes, [batchSize, (boxes.shape[0] / batchSize), 4]);\r\n        var scoresAndClasses = tf.sigmoid(tf.slice(classPredictions, [0, 0, 1], [-1, -1, -1]));\r\n        var scores = tf.slice(scoresAndClasses, [0, 0, 0], [-1, -1, 1]);\r\n        scores = tf.reshape(scores, [batchSize, scores.shape[1]]);\r\n        var boxesByBatch = tf.unstack(boxes);\r\n        var scoresByBatch = tf.unstack(scores);\r\n        return {\r\n            boxes: boxesByBatch,\r\n            scores: scoresByBatch\r\n        };\r\n    });\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}