{"ast":null,"code":"import _asyncToGenerator from \"/Users/alexdalgleishmorel/Desktop/UofC/FALL 24/581/581-project3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as faceapi from 'face-api.js';\nimport * as i0 from \"@angular/core\";\nconst _c0 = [\"video\"];\nexport class MirrorComponent {\n  constructor() {\n    this.isHappy = false;\n    this.isSad = false;\n    this.expressionStartTime = null;\n    this.currentExpression = null;\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.loadModels();\n      _this.startVideo();\n    })();\n  }\n  loadModels() {\n    return _asyncToGenerator(function* () {\n      const modelPath = '/assets/models';\n      yield faceapi.nets.tinyFaceDetector.loadFromUri(modelPath);\n      yield faceapi.nets.faceLandmark68Net.loadFromUri(modelPath);\n      yield faceapi.nets.faceRecognitionNet.loadFromUri(modelPath);\n      yield faceapi.nets.faceExpressionNet.loadFromUri(modelPath);\n    })();\n  }\n  startVideo() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const stream = yield navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n        _this2.video.nativeElement.srcObject = stream;\n        _this2.video.nativeElement.onloadedmetadata = () => {\n          _this2.detectExpressions();\n        };\n      } catch (error) {\n        console.error('Error accessing webcam:', error);\n      }\n    })();\n  }\n  detectExpressions() {\n    var _this3 = this;\n    setInterval( /*#__PURE__*/_asyncToGenerator(function* () {\n      const detections = yield faceapi.detectAllFaces(_this3.video.nativeElement, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();\n      detections.forEach(detection => {\n        const {\n          expressions\n        } = detection;\n        const topExpression = _this3.getTopExpression(expressions);\n        // Track expression duration and set isHappy or isSad accordingly\n        _this3.trackExpression(topExpression);\n      });\n    }), 100);\n  }\n  // Helper to get the dominant expression\n  getTopExpression(expressions) {\n    return Object.entries(expressions).reduce((a, b) => b[1] > a[1] ? b : a)[0];\n  }\n  // Track expression for duration and toggle variables if condition is met\n  trackExpression(expression) {\n    const now = Date.now();\n    if (expression !== this.currentExpression) {\n      // Reset the timer if expression changes\n      this.currentExpression = expression;\n      this.expressionStartTime = now;\n    } else if (this.expressionStartTime && now - this.expressionStartTime >= 3000) {\n      // Check if expression has been constant for 3 seconds\n      this.isHappy = expression === 'happy';\n      this.isSad = expression === 'sad';\n      // Reset other states if necessary\n      if (this.isHappy) this.isSad = false;\n      if (this.isSad) this.isHappy = false;\n      // Reset the timer after setting the expression\n      this.expressionStartTime = now;\n      console.log(this.currentExpression);\n    }\n  }\n  static {\n    this.ɵfac = function MirrorComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || MirrorComponent)();\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MirrorComponent,\n      selectors: [[\"mirror\"]],\n      viewQuery: function MirrorComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 7);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.video = _t.first);\n        }\n      },\n      decls: 9,\n      vars: 0,\n      consts: [[\"video\", \"\"], [\"overlay\", \"\"], [1, \"content-title\"], [1, \"outer-content\"], [1, \"mirror-border\"], [1, \"inner-content\"], [\"autoplay\", \"\", \"muted\", \"\"]],\n      template: function MirrorComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 2);\n          i0.ɵɵtext(1, \"Mirror View\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(2, \"div\", 3)(3, \"div\", 4)(4, \"div\", 5);\n          i0.ɵɵelement(5, \"video\", 6, 0)(7, \"canvas\", null, 1);\n          i0.ɵɵelementEnd()()();\n        }\n      },\n      styles: [\".content-title[_ngcontent-%COMP%] {\\n  font-size: 1.5rem;\\n  text-align: center;\\n  color: #333;\\n  margin-bottom: 20px;\\n}\\n\\n.outer-content[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 90%;\\n  background-color: whitesmoke;\\n  border-radius: 10px;\\n  padding: 10px;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n}\\n\\n.mirror-border[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  padding: 25px;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  border-radius: 10px;\\n  background-image: url(\\\"/assets/wood-texture.jpeg\\\");\\n  background-size: cover;\\n  background-position: center;\\n}\\n\\n.inner-content[_ngcontent-%COMP%] {\\n  position: relative;\\n  width: 110%;\\n  height: 100%;\\n  background-color: whitesmoke;\\n  border-radius: 10px;\\n  padding: 10px;\\n  overflow: hidden;\\n}\\n.inner-content[_ngcontent-%COMP%]   video[_ngcontent-%COMP%], .inner-content[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%] {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  width: 100%;\\n  height: 100%;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9taXJyb3IvbWlycm9yLmNvbXBvbmVudC5zY3NzIiwid2VicGFjazovLy4vLi4vLi4vLi4vRkFMTCUyMDI0LzU4MS81ODEtcHJvamVjdDMvc3JjL2FwcC9jb21wb25lbnRzL21pcnJvci9taXJyb3IuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxpQkFBQTtFQUNBLGtCQUFBO0VBQ0EsV0FBQTtFQUNBLG1CQUFBO0FDQ0o7O0FERUE7RUFDSSxXQUFBO0VBQ0EsV0FBQTtFQUNBLDRCQUFBO0VBQ0EsbUJBQUE7RUFDQSxhQUFBO0VBQ0EsYUFBQTtFQUNBLHVCQUFBO0VBQ0EsbUJBQUE7QUNDSjs7QURFQTtFQUNJLFdBQUE7RUFDQSxZQUFBO0VBQ0EsYUFBQTtFQUNBLGFBQUE7RUFDQSx1QkFBQTtFQUNBLG1CQUFBO0VBQ0EsbUJBQUE7RUFDQSxrREFBQTtFQUNBLHNCQUFBO0VBQ0EsMkJBQUE7QUNDSjs7QURFQTtFQUNJLGtCQUFBO0VBQ0EsV0FBQTtFQUNBLFlBQUE7RUFDQSw0QkFBQTtFQUNBLG1CQUFBO0VBQ0EsYUFBQTtFQUNBLGdCQUFBO0FDQ0o7QURDSTtFQUNJLGtCQUFBO0VBQ0EsTUFBQTtFQUNBLE9BQUE7RUFDQSxXQUFBO0VBQ0EsWUFBQTtBQ0NSIiwic291cmNlc0NvbnRlbnQiOlsiLmNvbnRlbnQtdGl0bGUge1xuICAgIGZvbnQtc2l6ZTogMS41cmVtO1xuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICBjb2xvcjogIzMzMztcbiAgICBtYXJnaW4tYm90dG9tOiAyMHB4O1xufVxuICBcbi5vdXRlci1jb250ZW50IHtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBoZWlnaHQ6IDkwJTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZXNtb2tlO1xuICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7XG4gICAgcGFkZGluZzogMTBweDtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG59XG4gIFxuLm1pcnJvci1ib3JkZXIge1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGhlaWdodDogMTAwJTtcbiAgICBwYWRkaW5nOiAyNXB4O1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICBib3JkZXItcmFkaXVzOiAxMHB4O1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgnL2Fzc2V0cy93b29kLXRleHR1cmUuanBlZycpO1xuICAgIGJhY2tncm91bmQtc2l6ZTogY292ZXI7XG4gICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyO1xufVxuICBcbi5pbm5lci1jb250ZW50IHtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgd2lkdGg6IDExMCU7XG4gICAgaGVpZ2h0OiAxMDAlO1xuICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlc21va2U7XG4gICAgYm9yZGVyLXJhZGl1czogMTBweDtcbiAgICBwYWRkaW5nOiAxMHB4O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgICB2aWRlbywgY2FudmFzIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB0b3A6IDA7XG4gICAgICAgIGxlZnQ6IDA7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgfVxufVxuIiwiLmNvbnRlbnQtdGl0bGUge1xuICBmb250LXNpemU6IDEuNXJlbTtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xuICBjb2xvcjogIzMzMztcbiAgbWFyZ2luLWJvdHRvbTogMjBweDtcbn1cblxuLm91dGVyLWNvbnRlbnQge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiA5MCU7XG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlc21va2U7XG4gIGJvcmRlci1yYWRpdXM6IDEwcHg7XG4gIHBhZGRpbmc6IDEwcHg7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xufVxuXG4ubWlycm9yLWJvcmRlciB7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG4gIHBhZGRpbmc6IDI1cHg7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBib3JkZXItcmFkaXVzOiAxMHB4O1xuICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCIvYXNzZXRzL3dvb2QtdGV4dHVyZS5qcGVnXCIpO1xuICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyO1xuICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7XG59XG5cbi5pbm5lci1jb250ZW50IHtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICB3aWR0aDogMTEwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZXNtb2tlO1xuICBib3JkZXItcmFkaXVzOiAxMHB4O1xuICBwYWRkaW5nOiAxMHB4O1xuICBvdmVyZmxvdzogaGlkZGVuO1xufVxuLmlubmVyLWNvbnRlbnQgdmlkZW8sIC5pbm5lci1jb250ZW50IGNhbnZhcyB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgdG9wOiAwO1xuICBsZWZ0OiAwO1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xufSJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n    });\n  }\n}","map":{"version":3,"names":["faceapi","MirrorComponent","constructor","isHappy","isSad","expressionStartTime","currentExpression","ngOnInit","_this","_asyncToGenerator","loadModels","startVideo","modelPath","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceExpressionNet","_this2","stream","navigator","mediaDevices","getUserMedia","video","nativeElement","srcObject","onloadedmetadata","detectExpressions","error","console","_this3","setInterval","detections","detectAllFaces","TinyFaceDetectorOptions","withFaceExpressions","forEach","detection","expressions","topExpression","getTopExpression","trackExpression","Object","entries","reduce","a","b","expression","now","Date","log","selectors","viewQuery","MirrorComponent_Query","rf","ctx","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵelement"],"sources":["/Users/alexdalgleishmorel/Desktop/UofC/FALL 24/581/581-project3/src/app/components/mirror/mirror.component.ts","/Users/alexdalgleishmorel/Desktop/UofC/FALL 24/581/581-project3/src/app/components/mirror/mirror.component.html"],"sourcesContent":["import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\nimport * as faceapi from 'face-api.js';\n\n@Component({\n  selector: 'mirror',\n  templateUrl: './mirror.component.html',\n  styleUrls: ['./mirror.component.scss'],\n})\nexport class MirrorComponent implements OnInit {\n  @ViewChild('video', { static: true }) video!: ElementRef;\n\n  isHappy = false;\n  isSad = false;\n  private expressionStartTime: number | null = null;\n  private currentExpression: string | null = null;\n\n  async ngOnInit() {\n    await this.loadModels();\n    this.startVideo();\n  }\n\n  async loadModels() {\n    const modelPath = '/assets/models';\n    await faceapi.nets.tinyFaceDetector.loadFromUri(modelPath);\n    await faceapi.nets.faceLandmark68Net.loadFromUri(modelPath);\n    await faceapi.nets.faceRecognitionNet.loadFromUri(modelPath);\n    await faceapi.nets.faceExpressionNet.loadFromUri(modelPath);\n  }\n\n  async startVideo() {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n      this.video.nativeElement.srcObject = stream;\n\n      this.video.nativeElement.onloadedmetadata = () => {\n        this.detectExpressions();\n      };\n    } catch (error) {\n      console.error('Error accessing webcam:', error);\n    }\n  }\n\n  detectExpressions() {\n    setInterval(async () => {\n      const detections = await faceapi\n        .detectAllFaces(this.video.nativeElement, new faceapi.TinyFaceDetectorOptions())\n        .withFaceExpressions();\n\n      detections.forEach(detection => {\n        const { expressions } = detection;\n        const topExpression = this.getTopExpression(expressions);\n\n        // Track expression duration and set isHappy or isSad accordingly\n        this.trackExpression(topExpression);\n      });\n    }, 100);\n  }\n\n  // Helper to get the dominant expression\n  getTopExpression(expressions: faceapi.FaceExpressions): string {\n    return Object.entries(expressions)\n      .reduce((a, b) => (b[1] > a[1] ? b : a))[0];\n  }\n\n  // Track expression for duration and toggle variables if condition is met\n  trackExpression(expression: string) {\n    const now = Date.now();\n\n    if (expression !== this.currentExpression) {\n      // Reset the timer if expression changes\n      this.currentExpression = expression;\n      this.expressionStartTime = now;\n    } else if (this.expressionStartTime && now - this.expressionStartTime >= 3000) {\n      // Check if expression has been constant for 3 seconds\n      this.isHappy = expression === 'happy';\n      this.isSad = expression === 'sad';\n\n      // Reset other states if necessary\n      if (this.isHappy) this.isSad = false;\n      if (this.isSad) this.isHappy = false;\n\n      // Reset the timer after setting the expression\n      this.expressionStartTime = now;\n\n      console.log(this.currentExpression);\n    }\n  }\n}\n","<div class=\"content-title\">Mirror View</div>\n<div class=\"outer-content\">\n  <div class=\"mirror-border\">\n    <div class=\"inner-content\">\n      <video #video autoplay muted></video>\n      <canvas #overlay></canvas>\n    </div>\n  </div>\n</div>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}