{"ast":null,"code":"export function nonMaxSuppression(boxes, scores, maxOutputSize, iouThreshold, scoreThreshold) {\n  var numBoxes = boxes.shape[0];\n  var outputSize = Math.min(maxOutputSize, numBoxes);\n  var candidates = scores.map(function (score, boxIndex) {\n    return {\n      score: score,\n      boxIndex: boxIndex\n    };\n  }).filter(function (c) {\n    return c.score > scoreThreshold;\n  }).sort(function (c1, c2) {\n    return c2.score - c1.score;\n  });\n  var suppressFunc = function (x) {\n    return x <= iouThreshold ? 1 : 0;\n  };\n  var selected = [];\n  candidates.forEach(function (c) {\n    if (selected.length >= outputSize) {\n      return;\n    }\n    var originalScore = c.score;\n    for (var j = selected.length - 1; j >= 0; --j) {\n      var iou = IOU(boxes, c.boxIndex, selected[j]);\n      if (iou === 0.0) {\n        continue;\n      }\n      c.score *= suppressFunc(iou);\n      if (c.score <= scoreThreshold) {\n        break;\n      }\n    }\n    if (originalScore === c.score) {\n      selected.push(c.boxIndex);\n    }\n  });\n  return selected;\n}\nfunction IOU(boxes, i, j) {\n  var boxesData = boxes.arraySync();\n  var yminI = Math.min(boxesData[i][0], boxesData[i][2]);\n  var xminI = Math.min(boxesData[i][1], boxesData[i][3]);\n  var ymaxI = Math.max(boxesData[i][0], boxesData[i][2]);\n  var xmaxI = Math.max(boxesData[i][1], boxesData[i][3]);\n  var yminJ = Math.min(boxesData[j][0], boxesData[j][2]);\n  var xminJ = Math.min(boxesData[j][1], boxesData[j][3]);\n  var ymaxJ = Math.max(boxesData[j][0], boxesData[j][2]);\n  var xmaxJ = Math.max(boxesData[j][1], boxesData[j][3]);\n  var areaI = (ymaxI - yminI) * (xmaxI - xminI);\n  var areaJ = (ymaxJ - yminJ) * (xmaxJ - xminJ);\n  if (areaI <= 0 || areaJ <= 0) {\n    return 0.0;\n  }\n  var intersectionYmin = Math.max(yminI, yminJ);\n  var intersectionXmin = Math.max(xminI, xminJ);\n  var intersectionYmax = Math.min(ymaxI, ymaxJ);\n  var intersectionXmax = Math.min(xmaxI, xmaxJ);\n  var intersectionArea = Math.max(intersectionYmax - intersectionYmin, 0.0) * Math.max(intersectionXmax - intersectionXmin, 0.0);\n  return intersectionArea / (areaI + areaJ - intersectionArea);\n}","map":{"version":3,"names":["nonMaxSuppression","boxes","scores","maxOutputSize","iouThreshold","scoreThreshold","numBoxes","shape","outputSize","Math","min","candidates","map","score","boxIndex","filter","c","sort","c1","c2","suppressFunc","x","selected","forEach","length","originalScore","j","iou","IOU","push","i","boxesData","arraySync","yminI","xminI","ymaxI","max","xmaxI","yminJ","xminJ","ymaxJ","xmaxJ","areaI","areaJ","intersectionYmin","intersectionXmin","intersectionYmax","intersectionXmax","intersectionArea"],"sources":["/Users/alexdalgleishmorel/Desktop/UofC/FALL 24/581/581-project3/node_modules/face-api.js/build/es6/ssdMobilenetv1/nonMaxSuppression.js"],"sourcesContent":["export function nonMaxSuppression(boxes, scores, maxOutputSize, iouThreshold, scoreThreshold) {\r\n    var numBoxes = boxes.shape[0];\r\n    var outputSize = Math.min(maxOutputSize, numBoxes);\r\n    var candidates = scores\r\n        .map(function (score, boxIndex) { return ({ score: score, boxIndex: boxIndex }); })\r\n        .filter(function (c) { return c.score > scoreThreshold; })\r\n        .sort(function (c1, c2) { return c2.score - c1.score; });\r\n    var suppressFunc = function (x) { return x <= iouThreshold ? 1 : 0; };\r\n    var selected = [];\r\n    candidates.forEach(function (c) {\r\n        if (selected.length >= outputSize) {\r\n            return;\r\n        }\r\n        var originalScore = c.score;\r\n        for (var j = selected.length - 1; j >= 0; --j) {\r\n            var iou = IOU(boxes, c.boxIndex, selected[j]);\r\n            if (iou === 0.0) {\r\n                continue;\r\n            }\r\n            c.score *= suppressFunc(iou);\r\n            if (c.score <= scoreThreshold) {\r\n                break;\r\n            }\r\n        }\r\n        if (originalScore === c.score) {\r\n            selected.push(c.boxIndex);\r\n        }\r\n    });\r\n    return selected;\r\n}\r\nfunction IOU(boxes, i, j) {\r\n    var boxesData = boxes.arraySync();\r\n    var yminI = Math.min(boxesData[i][0], boxesData[i][2]);\r\n    var xminI = Math.min(boxesData[i][1], boxesData[i][3]);\r\n    var ymaxI = Math.max(boxesData[i][0], boxesData[i][2]);\r\n    var xmaxI = Math.max(boxesData[i][1], boxesData[i][3]);\r\n    var yminJ = Math.min(boxesData[j][0], boxesData[j][2]);\r\n    var xminJ = Math.min(boxesData[j][1], boxesData[j][3]);\r\n    var ymaxJ = Math.max(boxesData[j][0], boxesData[j][2]);\r\n    var xmaxJ = Math.max(boxesData[j][1], boxesData[j][3]);\r\n    var areaI = (ymaxI - yminI) * (xmaxI - xminI);\r\n    var areaJ = (ymaxJ - yminJ) * (xmaxJ - xminJ);\r\n    if (areaI <= 0 || areaJ <= 0) {\r\n        return 0.0;\r\n    }\r\n    var intersectionYmin = Math.max(yminI, yminJ);\r\n    var intersectionXmin = Math.max(xminI, xminJ);\r\n    var intersectionYmax = Math.min(ymaxI, ymaxJ);\r\n    var intersectionXmax = Math.min(xmaxI, xmaxJ);\r\n    var intersectionArea = Math.max(intersectionYmax - intersectionYmin, 0.0) *\r\n        Math.max(intersectionXmax - intersectionXmin, 0.0);\r\n    return intersectionArea / (areaI + areaJ - intersectionArea);\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}